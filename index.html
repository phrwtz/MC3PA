<!DOCTYPE html>
<html>

<head>
    <title>Test; MC3PA JSON file analysis</title>
    <link rel="stylesheet" type="text/css" href="style.css">

</head>


<body>
    <h1>Analyze MC3PA Data</h1>

    Chats to search for:<input type="file" id="chats" name="chats[]" onchange="openChats(event)"></input><br><br>

    Team data:<input type="file" id="files" name="files[]" multiple onchange="openFiles(event)"></input><br><br>

    <button type="button" id="analyzeButton" style="display:none" onclick="parseJSON(data)">Analyze</button><br>

    <span>
        <button type="button" id="reportButton" style="display:none" onclick="summaryReport()">Summary report</button>
        <button type="button" id="downloadButton" style="display:none" onclick="download(teams.txt, teams)">Download
            teams</button><br>
    </span>

    <div id="loading" img src="giphy.gif" style.display="none"></div>
    <div id="filter">
        <table id="filterTable" style="display:none">
            <tr>
                <th>Level</td>
                <th>Outcome</td>
                <th>Goal Voltages</td>
                <th>Goal Resistances</td>
            </tr>
            <tr>
                <td>
                    A(<span id="A#"></span>)
                    <input type="checkbox" name="level" id="levelA" onchange="updateOutcomes()">
                    </input>
                </td>
                <td>Success(<span id="Success#"></span>)
                    <input type="checkbox" name="outcome" id="success" onchange="updateVGoals()">
                <td>All chatted(<span id="VAllChatted#"></span>)
                    <input type="checkbox" name="voltage" id="VAllChat" onchange="updateRGoals()">
                    </input>
                </td>
                <td>
                    All chatted(<span id="RAllChatted#"></span>)
                    <input type="checkbox" name="resistance" id="RAllChat" onchange="updateRGoals(); actionsReport()">
                    </input>
                </td>
            </tr>
            <tr>
                <td>
                    B(<span id="B#"></span>)
                    <input type="checkbox" name="level" id="levelB" onchange="updateOutcomes()"></input>
                </td>
                <td>Failure(<span id="Failure#"></span>)
                    <input type="checkbox" name="outcome" id="failure" onchange="updateVGoals()">
                    </input>
                </td>
                <td>
                    Some chatted(<span id="VSomeChatted#"></span>)
                    <input type="checkbox" name="voltage" id="VSomeChat" onchange="updateRGoals()">
                    </input>
                </td>
                <td>Some chatted(<span id="RSomeChatted#"></span>)
                    <input type="checkbox" name="resistance" id="RSomeChat" onchange="updateRGoals(); actionsReport()">
                    </input>
                </td>
            </tr>
            <tr>
                <td>
                    C(<span id="C#"></span>)
                    <input type="checkbox" name="level" id="levelC" onchange="updateOutcomes()"></input>
                </td>
                <td></td>
                <td>None chatted(<span id="VNotChatted#"></span>)
                    <input type="checkbox" name="resistance" id="VNoChat" onchange="updateOutcomes()">
                    </input>
                </td>
                <td>None chatted(<span id="RNotChatted#"></span>)
                    <input type="checkbox" name="resistance" id="RNotChat" onchange="updateRGoals(); actionsReport()">
                    </input>
                </td>
            </tr>
            <tr>
                <td>
                    D(<span id="D#"></span>)
                    <input type="checkbox" name="level" id="levelD" onchange="updateOutcomes()"></input>
                </td>
                <td></td>
                <td></td>
                <td>All calculated(<span id="RAllCalculated#"></span>)
                    <input type="checkbox" name="resistance" id="RAllCalc" onchange="updateRGoals(); actionsReport()">
                    </input>
                </td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td>Some calculated(<span id="RSomeCalculated#"></span>)
                    <input type="checkbox" name="resistance" id="RSomeCalc" onchange="updateRGoals(); actionsReport()">
                    </input>
                </td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td>None calculated(<span id="RNotCalculated#"></span>)
                    <input type="checkbox" name="resistance" id="RNotCalc" onchange="updateRGoals(); actionsReport()">
                    </input>
                </td>
            </tr>
        </table>
    </div>
    <div id="summaryDiv"></div>
    </div>
    <p id="data"></p>
    <form id="levels"></form>
    <style>
        #summaryDiv table {
            display: inline-block;
            margin: 10px;
            width: 300px;
        }
    </style>
    <script>
        var data = new Array;
        var fileCount = 0;
        var ready = false; //Will turn true when all the files have been read

        function openFiles(evt) {
            var files = evt.target.files; // FileList object
            for (var i = 0, f; f = files[i]; i++) {
                var reader = new FileReader();
                //closure to capture the file information
                reader.onerror = function (err) {
                    console.log(err);
                }
                reader.onloadend = function (theFile) {
                    return function (e) {
                        fileCount++;
                        if (fileCount >= files.length - 1) {
                            document.getElementById("analyzeButton").style.display = "block";
                            //                          progBar.style.display = "none";
                        }
                        data.push(e.target.result); //Push the student data onto the arrayâ€“
                    }
                }(f);
                reader.readAsText(f);
            }
        }

        function openChats(evt) {
            var chatFiles = evt.target.files;
            var chats = "";
            var f = chatFiles[0];
            var reader = new FileReader();
            reader.onerror = function (err) {
                console.log(err);
            }
            reader.onloadend = function (theChats) {
                return function (e) {
                    chats = e.target.result;
                    chatsList = chats.split(", ");
                }
            }(f)
            reader.readAsText(f);
        }
    </script>

    <script src="parse-student-data.js"></script>
    <!--<script src="download.js"></script>-->
    <script src="html-support.js"></script>
    <script src="transactions.js"></script>
    <script src="parse-file.js"></script>
    <script src="utils.js"></script>
    <script src="html-utils.js"></script>
    <script src="analysis-tools.js"></script>
    <script src="summary-data.js"></script>
    <script src="report-tools.js"></script>
    <script src="reporting-functions.js"></script>
    <script src="summary-reports.js"></script>
    <script src="PapaParse-4.1.2/papaparse.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
</body>

</html>