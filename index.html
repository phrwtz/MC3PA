<!DOCTYPE html>
<html>

<head>
    <title>Test; MC3PA JSON file analysis</title>
    <link rel="stylesheet" type="text/css" href="style.css">

</head>


<body>
    <h1>Analyze MC3PA Data</h1>
    Chats to search for:<input type="file" id="chats" name="chats[]" onchange="openChats(event)"></input><br><br>
    Team data:<input type="file" id="files" name="files[]" multiple onchange="openFiles(event)"></input><br><br>
    <button type="button" id="analyzeButton" style="display:none" onclick="parseJSON(data)">Analyze</button><br>
    <progress id="fileProgress" style="display:none"></progress>
    <button type="button" id="reportButton" style="display:none" onclick="summaryReport()">Summary report</button><br>
    <progress id="analysisProgress" style="display:none"></progress>
    <button type="button" height="400" id="SetActionReportsVisibility" style="display:none" onclick="actionsReport()">Actions
    </button><br>
    <div id="loading" img src="giphy.gif" style.display="none"></div>
    <div id="summaryDiv"></div>
    <div id="chatsDiv">
    </div>
    <p id="data"></p>
    <script>
        var data = new Array;
        var fileCount = 0;
        var ready = false; //Will turn true when all the files have been read

        function openFiles(evt) {
            var files = evt.target.files; // FileList object
            for (var i = 0, f; f = files[i]; i++) {
                var reader = new FileReader();
                //closure to capture the file information
                reader.onerror = function (err) {
                    console.log(err);
                }
                reader.onloadend = function (theFile) {
                    return function (e) {
                        fileCount++;
                        //                      progBar.value = fileCount;
                        //                      progBar.max = files.length - 1;
                        //                      progBar.style.display = "block";
                        if (fileCount >= files.length - 1) {
                            document.getElementById("analyzeButton").style.display = "block";
                            //                          progBar.style.display = "none";
                        }
                        data.push(e.target.result); //Push the student data onto the arrayâ€“
                    }
                }(f);
                reader.readAsText(f);
            }
        }

        function openChats(evt) {
            var chatFiles = evt.target.files;
            var chats = "";
            var f = chatFiles[0];
            var reader = new FileReader();
            reader.onerror = function (err) {
                console.log(err);
            }
            reader.onloadend = function (theChats) {
                return function (e) {
                    chats = e.target.result;
                    chatsList = chats.split(", ");
                }
            }(f)
            reader.readAsText(f);
            //          console.log("file read");
        }
    </script>

    <script src="parse-student-data.js"></script>
    <script src="html-support.js"></script>
    <script src="transactions.js"></script>
    <script src="parse-file.js"></script>
    <script src="utils.js"></script>
    <script src="html-utils.js"></script>
    <script src="analysis-tools.js"></script>
    <script src="summary-data.js"></script>
    <script src="report-tools.js"></script>
    <script src="reporting-functions.js"></script>
    <script src="summary-reports.js"></script>
    <script src="PapaParse-4.1.2/papaparse.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
</body>

</html>