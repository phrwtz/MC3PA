<!DOCTYPE html>
<html>

<head>
    <title>Test; MC3PA JSON file analysis</title>
    <link rel="stylesheet" type="text/css" href="style.css">

</head>


<body>
    <h1>Analyze MC3PA Data</h1>
    <!--
    Chats to search for:<input type="file" id="chats" name="chats[]" onchange="openChats(event)"></input><br><br>
-->
    Team data:<input type="file" id="files" name="files[]" multiple onchange="openFiles(event)"></input><br><br>

    <button type="button" id="analyzeButton" style="display:none" onclick="parseJSON(data)">Analyze</button><br>

    <span>
        <button type="button" id="reportButton" style="display:none" onclick="summaryReport()">Summary report</button>
    </span>

    <div id="filter" style="margin-top: 30px">
        <table id="filterTable" style="display:none">
            <tr style=background-color:palegreen>
                <th>Level</td>
                <th>Outcome</td>
                <th>Goal Voltage Chats</td>
                <th>Goal Resistance Calcs</td>
                <th>Goal Resistance Chats</td>
            </tr>
            <tr style=background-color:lightblue>
                <td>all/none(<span id="levels#"></span>)<input type="checkbox"  id="levels" name="level" onChange="toggleSelectAll('level'); updateLevels()"></input>
                </td>
                <td>all/none(<span id="outcomes#"></span>)
                    <input type="checkbox"  id="outcomes" name="outcome" onChange="toggleSelectAll('outcome'); updateLevels()"></input>
                </td>
                <td>
                    all/none(<span id="vchats#"></span>)<input type="checkbox"  id="vchats" name="vchat" onChange="toggleSelectAll('vchat');updateLevels()"></input>
                </td>
                <td>all/none(<span id="rcalcs#"></span>)<input type="checkbox"  id="rcalcs" name="rcalc" onChange="toggleSelectAll('rcalc');updateLevels()"></input>
                </td>
                <td>all/none(<span id="rchats#"></span>)<input type="checkbox"  id="rchats" name="rchat" onChange="toggleSelectAll('rchat');updateLevels()"></input>
                </td>
            </tr>
            <tr>
                <td>
                    A(<span id="A#"></span>)
                    <input type="checkbox"  name="level" id="levelA" onchange="updateLevels()">
                    </input>
                </td>

                <td>Success(<span id="Success#"></span>)
                    <input type="checkbox"  name="outcome" id="success" onchange="updateLevels()">
                </td>
                <td>All chatted(<span id="VAllChatted#"></span>)
                    <input type="checkbox"  name="vchat" id="VAllChat" onchange="updateLevels()">
                    </input>
                </td>
                <td>All calculated(<span id="RAllCalculated#"></span>)
                    <input type="checkbox"  name="rcalc" id="RAllCalc" onchange="updateLevels()">
                    </input>
                </td>
                <td>
                    All chatted(<span id="RAllChatted#"></span>)
                    <input type="checkbox"  name="rchat" id="RAllChat" onchange="actionsReport()">
                    </input>
                </td>
            </tr>
            <tr>
                <td>
                    B(<span id="B#"></span>)
                    <input type="checkbox"  name="level" id="levelB" onchange="updateLevels()"></input>
                </td>
                <td>Failure(<span id="Failure#"></span>)
                    <input type="checkbox"  name="outcome" id="failure" onchange="updateLevels()">
                    </input>
                </td>
                <td>
                    Some chatted(<span id="VSomeChatted#"></span>)
                    <input type="checkbox"  name="vchat" id="VSomeChat" onchange="updateLevels()">
                    </input>
                </td>
                <td>Some calculated(<span id="RSomeCalculated#"></span>)
                    <input type="checkbox"  name="rcalc" id="RSomeCalc" onchange="updateLevels()">
                    </input>
                </td>
                <td>Some chatted(<span id="RSomeChatted#"></span>)
                    <input type="checkbox"  name="rchat" id="RSomeChat" onchange="actionsReport()">
                    </input>
                </td>
            </tr>
            <tr>
                <td>
                    C(<span id="C#"></span>)
                    <input type="checkbox"  name="level" id="levelC" onchange="updateLevels()"></input>
                </td>
                <td></td>
                <td>None chatted(<span id="VNotChatted#"></span>)
                    <input type="checkbox"  name="vchat" id="VNoChat" onchange="updateLevels()">
                    </input>
                </td>
                <td>None calculated(<span id="RNotCalculated#"></span>)
                    <input type="checkbox"  name="rcalc" id="RNoCalc" onchange="updateLevels()">
                    </input>
                </td>
                <td>None chatted(<span id="RNotChatted#"></span>)
                    <input type="checkbox"  name="rchat" id="RNoChat" onchange="actionsReport()">
                    </input>
                </td>
            <tr>
                <td>
                    D(<span id="D#"></span>)
                    <input type="checkbox"  name="level" id="levelD" onchange="updateLevels()"></input>
                </td>
            </tr>
        </table>
    </div>
    <div id="summaryDiv"></div>
    </div>
    <p id="data"></p>
    <span>
        <p id="levels"></p>
        <p id="chatsPara"></p>
    </span>
    <style>
        #summaryDiv table {
            display: inline-block;
            margin: 10px;
            width: 300px;
        }
    </style>
    <script>
        var data = new Array;
        var fileCount = 0;

        function openFiles(evt) {
            var files = evt.target.files; // FileList object
            for (var i = 0, f; f = files[i]; i++) {
                var reader = new FileReader();
                //closure to capture the file information
                reader.onerror = function (err) {
                    console.log(err);
                }
                reader.onloadend = function (theFile) {
                    return function (e) {
                        fileCount++;
                        if (fileCount >= files.length - 1) {
                            document.getElementById("analyzeButton").style.display = "block";
                            //                          progBar.style.display = "none";
                        }
                        data.push(e.target.result); //Push the student data onto the arrayâ€“
                    }
                }(f);
                reader.readAsText(f);
            }
        }

        function openChats(evt) {
            var chatFiles = evt.target.files;
            var chats = "";
            var f = chatFiles[0];
            var reader = new FileReader();
            reader.onerror = function (err) {
                console.log(err);
            }
            reader.onloadend = function (theChats) {
                return function (e) {
                    chats = e.target.result;
                    chatsList = chats.split(", ");
                }
            }(f)
            reader.readAsText(f);
        }
    </script>

    <script src="parse-student-data.js"></script>
    <!--<script src="download.js"></script>-->
    <script src="html-support.js"></script>
    <script src="transactions.js"></script>
    <script src="parse-file.js"></script>
    <script src="utils.js"></script>
    <script src="html-utils.js"></script>
    <script src="analysis-tools.js"></script>
    <script src="summary-data.js"></script>
    <script src="report-tools.js"></script>
    <script src="reporting-functions.js"></script>
    <script src="summary-reports.js"></script>
    <script src="PapaParse-4.1.2/papaparse.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
</body>

</html>